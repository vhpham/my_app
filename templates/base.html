{% extends 'bootstrap/base.html' %}
{% block scripts %}
    {{ super() }}
<script type="text/javascript" id="myjs">
var authID = '';
/* attach a submit handler to the form */
$("#myformlogin").submit(function(event) {
  /* stop form from submitting normally */
  event.preventDefault();

  /* get the action attribute from the <form action=""> element */
  var $form = $( this ),
      url = $form.attr( 'action' );

  var posting = $.ajax({
    url: url, 
    type: 'POST',          
    data: JSON.stringify({"username": $('#username').val(), 
                                   "password": $('#password').val(),
                                   "csrf_token": $('#csrf_token').val()
                                }),
    contentType: "application/json",
    dataType: "json",        
    complete: function(data){
        if (data.status != 200) {
            alert(data.responseJSON['msg']);
            authID = '';
        }
        else {
            console.log('login');
            authID = data.getResponseHeader('authorization');
            document.documentElement.innerHTML = data.responseText;
            eval(document.getElementById("myjs").innerHTML);
            
        }
    }           
    });
});

//function myFunction(){

$("#myformquery").submit(function(event) {
  /* stop form from submitting normally */
  event.preventDefault();

  /* get the action attribute from the <form action=""> element */
  var $form = $( this ),
      url = $form.attr( 'action' );

  var posting = $.ajax({
    url: url, 
    type: 'POST',          
    data: JSON.stringify({"type": $('#type').val(), 
                                   "match": $('#match').val(),
                                   "csrf_token": $('#csrf_token').val()
                                }),
    contentType: "application/json",
    dataType: "json",
    beforeSend: function(xhr) {
        xhr.setRequestHeader('Authorization', authID);
    },            
    complete: function(data){
        if (data.status != 200) {
            alert(data.responseJSON['msg']);
            console.log(authID);
        }
        else {
            console.log('query');
            authID = data.getResponseHeader('authorization');
            document.documentElement.innerHTML = data.responseText;
            eval(document.getElementById("myjs").innerHTML);
        }
    }           
    });  
});

</script>

{% endblock %}
{% block title %}
    {% if title %}{{ title }} - Microblog{% else %}Welcome to Microblog{% endif %}
{% endblock %}

{% block content %}
    <div class="container" id="container">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
            <div class="alert alert-info" role="alert">{{ message }}</div>
            {% endfor %}
        {% endif %}
        {% endwith %}

        {# application content needs to be provided in the app_content block #}
        {% block app_content %}{% endblock %}
    </div>
{% endblock %}